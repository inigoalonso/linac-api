<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<title>{% block title %}ESS Linac Parameter Book{% endblock %}</title>
	<link rel="shortcut icon" href="static/images/favi.ico">
    <link href="static/css/lib/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="static/css/lib/bootstrap-theme.min.css" rel="stylesheet" media="screen">
	<link href="static/css/lib/bootstrap-table.min.css" rel="stylesheet">
	<link href="static/css/lib/bootstrap-treeview.min.css" rel="stylesheet">
	<style>
	body {
	    padding-top: 70px;
		}
	</style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	<script src="//fast.eager.io/Nwdx8E2n_O.js"></script>
	<script src="static/js/lib/pace.min.js"></script>
	<link href="static/css/lib/pace/themes/blue/pace-theme-big-counter.css" rel="stylesheet" />
</head>
<body>
	<div class="container">
		<nav class="navbar navbar-default navbar-fixed-top">
		  <div class="container-fluid">
		    <!-- Brand and toggle get grouped for better mobile display -->
		    <div class="navbar-header">
			  <a class="navbar-brand" href="#">
				  <img alt="Brand" width="20" height="20" src="static/images/ESS_Alone_Frugal_White_BlueBK_600.png">
			  </a>
		      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
		        <span class="sr-only">Toggle navigation</span>
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		      </button>
		      <a class="navbar-brand" href="/">ESS Linac Parameter Book</a>
		    </div>

		    <!-- Collect the nav links, forms, and other content for toggling -->
		    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
	          <ul class="nav navbar-nav">
	              <li class="active"><a href="#info" data-toggle="tab">Info <span class="sr-only">(current)</span></a></li>
	              <li class="dropdown">
	                <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-expanded="false">
	                  PBS <span class="caret"></span>
	                </a>
	                <ul class="dropdown-menu" role="menu">
	                  <li><a href="#pbsLayout" data-toggle="tab">PBS Layout</a></li>
	                  <li><a href="#pbsTree" data-toggle="tab">PBS Tree</a></li>
	                  <li><a href="#xmlTree" data-toggle="tab">XML Tree</a></li>
	                </ul>
	              </li>
	              <li class="dropdown">
	                <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-expanded="false">
	                  Data <span class="caret"></span>
	                </a>
	                <ul class="dropdown-menu" role="menu">
	                  <li><a href="#sectionData" data-toggle="tab">Section data</a></li>
	                  <li><a href="#cellData" data-toggle="tab">Cell data</a></li>
	                  <li><a href="#slotData" data-toggle="tab">Slot data</a></li>
	                  <li><a href="#bleData" data-toggle="tab">BLE data</a></li>
	                  <li><a href="#monitorData" data-toggle="tab">Monitor data</a></li>
	                </ul>
	              </li>
	              <li class="dropdown">
	                <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-expanded="false">
	                  Parts <span class="caret"></span>
	                </a>
	                <ul class="dropdown-menu" role="menu">
	                  <li><a href="#cellParts" data-toggle="tab">Cell Parts</a></li>
	                  <li><a href="#slotParts" data-toggle="tab">Slot Parts</a></li>
	                  <li><a href="#bleParts" data-toggle="tab">Beam-line Parts</a></li>
	                  <li><a href="#monitorParts" data-toggle="tab">Monitor Parts</a></li>
	                </ul>
	              </li>
	              <li><a href="#legoSets" data-toggle="tab">Lego Sets</a></li>
	              <li><a href="#plots" data-toggle="tab">Plots</a></li>
	              <li><a href="#emittances" data-toggle="tab">Emittances</a></li>

	          </ul>
		      <ul class="nav navbar-nav navbar-right">
		        <li class="dropdown">
		          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"> External Links <span class="caret"></span></a>
		          <ul class="dropdown-menu" role="menu">
		            <li><a href="https://aig.esss.lu.se:8443/LinacLegoWebApp/">LinacLego Web App</a></li>
		            <li><a href="https://github.com/inigoalonso/linac-api">Repository for this site</a></li>
		            <li class="divider"></li>
		            <li><a href="mailto:inigo.alonso@esss.se?Subject=linac-api">Contact</a></li>
		          </ul>
		        </li>
		      </ul>
		    </div><!-- /.navbar-collapse -->
		  </div><!-- /.container-fluid -->
		</nav>
		<div class="alert alert-danger alert-dismissible" role="alert">
		  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		  <strong>Warning!</strong> This prototype is a proof of concept, for production data please refer to <a href="https://aig.esss.lu.se:8443/LinacLegoWebApp/" class="alert-link">linacLego</a>.
		</div>
		{% block content %}{% endblock %}
	</div>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
	<script src="static/js/lib/bootstrap.min.js"></script>
	<script src="static/js/lib/bootstrap-table.min.js"></script>
	<script src="static/js/lib/bootstrap-table-export.min.js"></script>
	<script src="static/js/lib/d3.min.js"></script>
    <script src="static/js/lib/bootstrap-treeview.min.js"></script>
	<script>
	var dataoriginal = [
	  {
	    "text": "linacLego",
		"data": [{"version":"0.0"}, {"comment": "This is a comment abot the linacLego."}],
	    "nodes": [
	      {
	        "text": "header",
		    "data": [{"version":"1.5"}, {"comment": "This is another comment."}],
	        "nodes": [
	          {
	            "text": "slotModels",
				"data": [{"version":"5.4"}, {"comment": "This is a random comment."}]
	          },
	          {
	            "text": "cellModels",
				"data": [{"version":"3.9"}, {"comment": "This is a funny comment."}]
	          },
	          {
	            "text": "legoSets",
				"data": [{"version":"4.2"}, {"comment": "This is not the comment you are looking for."}]
	          },
	          {
	            "text": "monitorSets",
				"data": [{"version":"3.0"}, {"comment": "This is the true comment."}]
	          }
	        ]
	      },
	      {
	        "text": "linac",
			"data": [{"version":"1.5"}, {"comment": "This is comment wishes to be a comet."}]
	      }
	    ]
	  }
	];

	var datatest = [
{ "text" : "linacLego", "nodes" : { "comment" : "New HEBT and A2T drawings", "date" : "25-Mar-2015", "revNo" : 4.11, "title" : "EssLinac", "text" : "linac", "nodes" : { "linacData" : { "text" : "d", "nodes" : [ { "id" : "ekin", "type" : "double", "unit" : "MeV", "value" : 3.6 }, { "id" : "beamFrequency", "type" : "double", "unit" : "MHz", "value" : 352.21 }, { "id" : "xSurvey", "type" : "double", "unit" : "m", "value" : 0.0 }, { "id" : "ySurvey", "type" : "double", "unit" : "m", "value" : -4.5 }, { "id" : "zSurvey", "type" : "double", "unit" : "m", "value" : -595.4308 }, { "id" : "pitchSurvey", "type" : "double", "unit" : "deg", "value" : 0.0 }, { "id" : "rollSurvey", "type" : "double", "unit" : "deg", "value" : 0.0 }, { "id" : "yawSurvey", "type" : "double", "unit" : "deg", "value" : 0.0 }, { "id" : "alphaX", "type" : "double", "unit" : "unit", "value" : -0.05180557 }, { "id" : "betaX", "type" : "double", "unit" : "mm/pi.mrad", "value" : 0.20954707 }, { "id" : "emitX", "type" : "double", "unit" : "pi.mm.mrad", "value" : 0.2528802 }, { "id" : "alphaY", "type" : "double", "unit" : "unit", "value" : -0.30984507 }, { "id" : "betaY", "type" : "double", "unit" : "mm/pi.mrad", "value" : 0.37074837 }, { "id" : "emitY", "type" : "double", "unit" : "pi.mm.mrad", "value" : 0.2516941 }, { "id" : "alphaZ", "type" : "double", "unit" : "unit", "value" : -0.48100935 }, { "id" : "betaZ", "type" : "double", "unit" : "mm/pi.mrad", "value" : 0.9257504 }, { "id" : "emitZ", "type" : "double", "unit" : "pi.mm.mrad", "value" : 0.3614409 }, { "id" : "beamCurrent", "type" : "double", "unit" : "mA", "value" : 62.5 } ] }, "text" : "section", "nodes" : [ { "id" : "FE", "rfHarmonic" : 1, "xml:base" : "frontEndLego.xml", "cell" : { "id" : "FE", "model" : "FrontEndCell" } }, { "id" : "MEBT", "rfHarmonic" : 1, "xml:base" : "mebtLego.xml", "text" : "cell", "nodes" : [ { "id" : 010, "model" : "MebtCell01", "text" : "d", "nodes" : [ { "id" : "g1", "type" : "double", "value" : -16.1578 }, { "id" : "xkick", "type" : "double", "value" : 0.0 }, { "id" : "ykick", "type" : "double", "value" : 0.0 } ] }, { "id" : 020, "model" : "MebtQhpCav", "text" : "d", "nodes" : [ { "id" : "g1", "type" : "double", "value" : 19.4008 }, { "id" : "xkick", "type" : "double", "value" : 0.0 }, { "id" : "ykick", "type" : "double", "value" : 0.0 }, { "id" : "voltsT", "type" : "double", "value" : 125435.0 }, { "id" : "rfPhaseDeg", "type" : "double", "value" : -90.0 } ] }, { "id" : 030, "model" : "MebtCellQvp100Drift", "text" : "d", "nodes" : [ { "id" : "g1", "type" : "double", "value" : -14.2708 }, { "id" : "xkick", "type" : "double", "value" : 0.0 }, { "id" : "ykick", "type" : "double", "value" : 0.0 } ] }, { "id" : 040, "model" : "MebtCell04", "text" : "d", "nodes" : [ { "id" : "g1", "type" : "double", "value" : 2.05 }, { "id" : "xkick", "type" : "double", "value" : 0.0 }, { "id" : "ykick", "type" : "double", "value" : 0.0 }, { "id" : "voltsT", "type" : "double", "value" : 59000.0 }, { "id" : "rfPhaseDeg", "type" : "double", "value" : -90.0 } ] }, { "id" : 050, "model" : "MebtCellQhp100Drift", "text" : "d", "nodes" : [ { "id" : "g1", "type" : "double", "value" : 8.22001 }, { "id" : "xkick", "type" : "double", "value" : 0.0 }, { "id" : "ykick", "type" : "double", "value" : 0.0 } ] }, { "id" : 060, "model" : "MebtCellQvp100Drift", "text" : "d", "nodes" : [ { "id" : "g1", "type" : "double", "value" : -15.5667 }, { "id" : "xkick", "type" : "double", "value" : 0.0 }, { "id" : "ykick", "type" : "double", "value" : 0.0 } ] }, { "id" : 070, "model" : "MebtCell07", "text" : "d", "nodes" : [ { "id" : "g1", "type" : "double", "value" : 9.88831 }, { "id" : "xkick", "type" : "double", "value" : 0.0 }, { "id" : "ykick", "type" : "double", "value" : 0.0 } ] }, { "id" : 080, "model" : "MebtQvpCav", "text" : "d", "nodes" : [ { "id" : "g1", "type" : "double", "value" : -9.43731 }, { "id" : "xkick", "type" : "double", "value" : 0.0 }, { "id" : "ykick", "type" : "double", "value" : 0.0 }, { "id" : "voltsT", "type" : "double", "value" : 140000.0 }, { "id" : "rfPhaseDeg", "type" : "double", "value" : -90.0 } ] }, { "id" : 090, "model" : "MebtCellQhp100Drift", "text" : "d", "nodes" : [ { "id" : "g1", "type" : "double", "value" : 18.9722 }, { "id" : "xkick", "type" : "double", "value" : 0.0 }, { "id" : "ykick", "type" : "double", "value" : 0.0 } ] }, { "id" : 100, "model" : "MebtCellQvp100Drift", "text" : "d", "nodes" : [ { "id" : "g1", "type" : "double", "value" : -31.2924 }, { "id" : "xkick", "type" : "double", "value" : 0.0 }, { "id" : "ykick", "type" : "double", "value" : 0.0 } ] }, { "id" : 110, "model" : "MebtCellQhp100Drift", "text" : "d", "nodes" : [ { "id" : "g1", "type" : "double", "value" : 23.8721 }, { "id" : "xkick", "type" : "double", "value" : 0.0 }, { "id" : "ykick", "type" : "double", "value" : 0.0 } ] } ] } ] } } }

]

	//$('#selectable-output').html('<p>' + dataFromAPI + ' was fetched</p>');

	$(function() {

	var initSelectableTree = function(data) {
	          return $('#treeview').treeview({
	            data: dataoriginal,
	            multiSelect: $('#chk-select-multi').is(':checked'),
	            onNodeSelected: function(event, node) {
	              $('#selectable-output').html('<p>Extra data about ' + JSON.stringify(node.text) + ' will be displayed here:</p><p><strong>Version:</strong> ' + JSON.stringify(node.data[0].version) + '</p><p><strong>Comment:</strong> ' + JSON.stringify(node.data[1].comment) + '</p>');
	            },
	            onNodeUnselected: function (event, node) {
	              //$('#selectable-output').html('<p>' + node.text + ' was unselected</p>');
	            }
	          });
	        };





	var jqxhr = $.getJSON( "api/v1/lattices/master/sections/HEBT/cells")
	.done(function() {
	  //alert( "success" );
	  var dataFromAPI = jqxhr.responseJSON;
      var $selectableTree = initSelectableTree(dataFromAPI);

      var findSelectableNodes = function() {
        return $selectableTree.treeview('search', [ $('#input-select-node').val(), { ignoreCase: false, exactMatch: false } ]);
      };
      var selectableNodes = findSelectableNodes();

      $('#chk-select-multi:checkbox').on('change', function () {
        console.log('multi-select change');
        $selectableTree = initSelectableTree();
        selectableNodes = findSelectableNodes();
      });

      var search = function(e) {
        var pattern = $('#input-search').val();
        var options = {
          ignoreCase: $('#chk-ignore-case').is(':checked'),
          exactMatch: $('#chk-exact-match').is(':checked'),
          revealResults: $('#chk-reveal-results').is(':checked')
        };
        var results = $selectableTree.treeview('search', [ pattern, options ]);

        var output = '<p>' + results.length + ' matches found</p>';
        $.each(results, function (index, result) {
          output += '<p>- ' + result.text + '</p>';
        });
        $('#search-output').html(output);
      }

      $('#btn-search').on('click', search);
      $('#input-search').on('keyup', search);

      $('#btn-clear-search').on('click', function (e) {
        $searchableTree.treeview('clearSearch');
        $('#input-search').val('');
        $('#search-output').html('');
      });
      });
	})
	.fail(function() {
	  alert( "error" );
	})
	.always(function() {
	  //alert( "complete" );
	});

	</script>

</body>
</html>
